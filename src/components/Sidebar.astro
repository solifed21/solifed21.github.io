---
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const categories = [...new Set(posts.map(p => p.data.category).filter(Boolean))];
const tagMap = new Map<string, number>();
posts.forEach(p => p.data.tags?.forEach(tag => tagMap.set(tag, (tagMap.get(tag) || 0) + 1)));
const tags = [...tagMap.entries()].sort((a, b) => b[1] - a[1]);
---

<aside class="sidebar">
	<section>
		<h3>Categories</h3>
		<ul>
			{categories.map(cat => <li><a href={`/blog/category/${cat}/`}>{cat}</a></li>)}
		</ul>
	</section>
	<section>
		<h3>Tags</h3>
		<div class="tags">
			{tags.map(([tag, count]) => <a href={`/blog/tag/${tag}/`} class="tag">{tag} ({count})</a>)}
		</div>
	</section>
</aside>

<style>
	.sidebar {
		width: var(--sidebar-width);
		flex-shrink: 0;
		position: sticky;
		top: 80px;
		height: fit-content;
		padding: var(--space-3);
		background: var(--bg-card);
		border-radius: var(--radius);
		border: 1px solid var(--border-color);
	}
	.sidebar h3 {
		font-size: 0.7rem;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		margin-bottom: var(--space-2);
		padding-bottom: var(--space-1);
		border-bottom: 1px solid var(--border-color);
		color: var(--accent);
		font-weight: 600;
	}
	.sidebar section { margin-bottom: var(--space-3); }
	.sidebar section:last-child { margin-bottom: 0; }
	.sidebar ul { list-style: none; padding: 0; margin: 0; }
	.sidebar li a {
		display: block;
		padding: 6px 0;
		color: var(--text-secondary);
		font-size: 0.875rem;
		line-height: 1.4;
		transition: color var(--transition);
	}
	.sidebar li a:hover { color: var(--accent); }
	.tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
	.tag {
		background: var(--bg-secondary);
		padding: 4px 10px;
		border-radius: var(--radius-sm);
		font-size: 0.75rem;
		color: var(--text-secondary);
		border: 1px solid var(--border-color);
		transition: all var(--transition);
	}
	.tag:hover {
		background: var(--accent);
		color: var(--bg-primary);
		border-color: var(--accent);
	}
	@media (max-width: 720px) {
		.sidebar { width: 100%; position: static; }
	}
</style>
